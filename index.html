<!DOCTYPE html>
<head>
	<title>Diet Rotten Tomatoes</title>
	<script type="text/javascript" src="jQuery.js"></script>
	<style>
	body{
		width:960px;
		margin:0 auto;
		font-family:sans-serif;
	}

	h2{
		font-size:3em;
	}

	.theater{
		float:left;
		width:400px;
	}

	.dvd{
		float:right;
		width:400px;
	}

	.movie_search{
		width:100%;
		height: 40px;
		font-size: 35px;
	}

	.credits{
		clear:both;
		font-size:11px;
		text-align:center;
		margin-top:25px;
	}

	.number {
	font-weight: bold;
	font-size: 1.1em;
	}

	.movie{
	font-size:2em;
	height:500px;
	border-bottom:1px solid #ccc;
	}

	.dvd .movie:last-child, .theater .movie:last-child{
	border-bottom:none;
	}

	.movie p a:first-child{
	display: block;
	}

	a:visited, a:hover, a{
	color:black;
	}

	a.title{
	height:70px;
	display: block;
	}

	</style>
</head>
<body>
<form id="search">
	<label for="search"></label>
		<input class="movie_search" type="text" name="search" value="" placeholder="Toy Story 3">
</form>
<div class="results">
</div>
<div class="theater">
	<h2>Theaters</h2>
</div>
<div class="dvd">
	<h2>DVD</h2>
</div>
<div class="credits">
	All data provided by <a href="http://www.rottentomatoes.com/" alt="Rotten Tomatoes">Rotten Tomatoes</a>.
</div>
</body>
<script>
(function() {
var cleanRT = {
	init: function(){
		this.box_office();
		this.top_dvd();
	},
	fetch: function(searched){
		$.getJSON("http://api.rottentomatoes.com/api/public/v1.0/movies.json?apikey=bfsqfcdktj8yt8bvu2d2fzq2&page_limit=5&q=" + searched + "&callback=?", function(data) {
			$.each(data.movies, function(i, movies) {
	        var movie_obj = movies;
	        $('.results').append("<div class='movie'>" + "<p><a href='" + movie_obj.posters.original + "'><img src='" + movie_obj.posters.thumbnail + "' /></a><a class='title' target=_blank href='" + movie_obj.links.alternate + "'>" + movie_obj.title + "</a></p>" + "<div class='meta'><div class='rating'>" + movie_obj.mpaa_rating + "</div><div class='score'><p>Critics: <span class='number'>" + movie_obj.ratings.critics_score + "&#37;" + "<span></p><p>Users: <span class='number'>" + movie_obj.ratings.audience_score + "&#37;" + "<span></p></div></div>");
    		});
		});

	},
	box_office: function(){
		$.getJSON('http://api.rottentomatoes.com/api/public/v1.0/lists/movies/box_office.json?apikey=bfsqfcdktj8yt8bvu2d2fzq2&limit=5&country=us&callback=?', function(data) {
			$.each(data.movies, function(i, movies) {
	        var movie_obj = movies;
	        $('.theater').append("<div class='movie'>" + "<p><a href='" + movie_obj.posters.original + "'><img src='" + movie_obj.posters.thumbnail + "' /></a><a class='title' target=_blank href='" + movie_obj.links.alternate + "'>" + movie_obj.title + "</a></p>" + "<div class='meta'><div class='rating'>" + movie_obj.mpaa_rating + "</div><div class='score'><p>Critics: <span class='number'>" + movie_obj.ratings.critics_score + "&#37;" + "</span></p><p>Users: <span class='number'>" + movie_obj.ratings.audience_score + "&#37;" + "</span></p></div></div>");
    		});

	});
	},
	top_dvd: function(){
		$.getJSON('http://api.rottentomatoes.com/api/public/v1.0/lists/dvds/top_rentals.json?apikey=bfsqfcdktj8yt8bvu2d2fzq2&limit=5&country=us&callback=?', function(data) {
			$.each(data.movies, function(i, movies) {
		        var movie_obj = movies;
		        $('.dvd').append("<div class='movie'>" + "<p><a href='" + movie_obj.posters.original + "'><img src='" + movie_obj.posters.thumbnail + "' /></a><a class='title' target=_blank href='" + movie_obj.links.alternate + "'>" + movie_obj.title + "</a></p>" + "<div class='meta'><div class='rating'>" + movie_obj.mpaa_rating + "</div><div class='score'><p>Critics: <span class='number'>" + movie_obj.ratings.critics_score + "&#37;" + "</span></p><p>Users: <span class='number'>" + movie_obj.ratings.audience_score + "&#37;" + "</span></p></div></div>");
	    	});
	});
	}
}

cleanRT.init();

$('#search').submit(function(e){
	e.preventDefault();
	var search = $('#search .movie_search').val();
	$('.results').empty();
	$(".movie_search").blur();
	cleanRT.fetch(search);
});

var pathArray = window.location.hash;
if( !(pathArray == "") ){
	var escPathArray = unescape(pathArray);
	var searchTerm = escPathArray.split('#');
	cleanRT.fetch(searchTerm[1]);
}

})();

</script>
</html>